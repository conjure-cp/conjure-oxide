Model before rewriting:

letting dom be domain int(1..n)
letting n be 4
find x: matrix indexed by [dom] of dom

such that

allDiff(x[..]),
allDiff([ sum([x[i],i;int(1..2)]) | i : dom ]),
allDiff([ (x[i] - i) | i : dom ])

--

x[..], 
   ~~> slice_to_bubble ([("Bubble", 6000)])
{x[..] @ and([;int(1..)])}

--

allDiff({x[..] @ and([;int(1..)])}),
allDiff([ sum([x[i],i;int(1..2)]) | i : dom ]),
allDiff([ (x[i] - i) | i : dom ]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([ sum([x[i],i;int(1..2)]) | i : dom ]),
allDiff([ (x[i] - i) | i : dom ])

--

Via-solver generator model before rewriting:

find i: dom

--

Model before rewriting:

find i: dom

--

, 
   ~~> eval_root ([("Constant", 9001)])
true

--

Final model:

find i: dom

such that

true

[ sum([x[i],i;int(1..2)]) | i : dom ], 
   ~~> expand_comprehension_via_solver ([("Base", 2000)])
[sum([x[1],1;int(1..2)]),sum([x[2],2;int(1..2)]),sum([x[3],3;int(1..2)]),sum([x[4],4;int(1..2)]);int(1..)]

--

x[1], 
   ~~> index_to_bubble ([("Bubble", 6000)])
{x[1] @ and([__inDomain(1,int(1..4));int(1..)])}

--

allDiff(x[..]),
allDiff([sum([{x[1] @ and([__inDomain(1,int(1..4));int(1..)])},1;int(1..2)]),sum([x[2],2;int(1..2)]),sum([x[3],3;int(1..2)]),sum([x[4],4;int(1..2)]);int(1..)]),
allDiff([ (x[i] - i) | i : dom ]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..2)]),sum([x[2],2;int(1..2)]),sum([x[3],3;int(1..2)]),sum([x[4],4;int(1..2)]);int(1..)]),
allDiff([ (x[i] - i) | i : dom ])

--

x[2], 
   ~~> index_to_bubble ([("Bubble", 6000)])
{x[2] @ and([__inDomain(2,int(1..4));int(1..)])}

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..2)]),sum([{x[2] @ and([__inDomain(2,int(1..4));int(1..)])},2;int(1..2)]),sum([x[3],3;int(1..2)]),sum([x[4],4;int(1..2)]);int(1..)]),
allDiff([ (x[i] - i) | i : dom ]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..2)]),sum([x[2],2;int(1..2)]),sum([x[3],3;int(1..2)]),sum([x[4],4;int(1..2)]);int(1..)]),
allDiff([ (x[i] - i) | i : dom ])

--

x[3], 
   ~~> index_to_bubble ([("Bubble", 6000)])
{x[3] @ and([__inDomain(3,int(1..4));int(1..)])}

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..2)]),sum([x[2],2;int(1..2)]),sum([{x[3] @ and([__inDomain(3,int(1..4));int(1..)])},3;int(1..2)]),sum([x[4],4;int(1..2)]);int(1..)]),
allDiff([ (x[i] - i) | i : dom ]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..2)]),sum([x[2],2;int(1..2)]),sum([x[3],3;int(1..2)]),sum([x[4],4;int(1..2)]);int(1..)]),
allDiff([ (x[i] - i) | i : dom ])

--

x[4], 
   ~~> index_to_bubble ([("Bubble", 6000)])
{x[4] @ and([__inDomain(4,int(1..4));int(1..)])}

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..2)]),sum([x[2],2;int(1..2)]),sum([x[3],3;int(1..2)]),sum([{x[4] @ and([__inDomain(4,int(1..4));int(1..)])},4;int(1..2)]);int(1..)]),
allDiff([ (x[i] - i) | i : dom ]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..2)]),sum([x[2],2;int(1..2)]),sum([x[3],3;int(1..2)]),sum([x[4],4;int(1..2)]);int(1..)]),
allDiff([ (x[i] - i) | i : dom ])

--

sum([x[1],1;int(1..2)]), 
   ~~> matrix_to_list ([("Base", 2000)])
sum([x[1],1;int(1..)])

--

sum([x[2],2;int(1..2)]), 
   ~~> matrix_to_list ([("Base", 2000)])
sum([x[2],2;int(1..)])

--

sum([x[3],3;int(1..2)]), 
   ~~> matrix_to_list ([("Base", 2000)])
sum([x[3],3;int(1..)])

--

sum([x[4],4;int(1..2)]), 
   ~~> matrix_to_list ([("Base", 2000)])
sum([x[4],4;int(1..)])

--

Via-solver generator model before rewriting:

find i: dom

--

Model before rewriting:

find i: dom

--

, 
   ~~> eval_root ([("Constant", 9001)])
true

--

Final model:

find i: dom

such that

true

[ (x[i] - i) | i : dom ], 
   ~~> expand_comprehension_via_solver ([("Base", 2000)])
[(x[1] - 1),(x[2] - 2),(x[3] - 3),(x[4] - 4);int(1..)]

--

(x[1] - 1), 
   ~~> minus_to_sum ([("Base", 8400)])
sum([x[1],-(1);int(1..)])

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-(1);int(1..)]),(x[2] - 2),(x[3] - 3),(x[4] - 4);int(1..)]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),(x[2] - 2),(x[3] - 3),(x[4] - 4);int(1..)])

--

(x[2] - 2), 
   ~~> minus_to_sum ([("Base", 8400)])
sum([x[2],-(2);int(1..)])

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-(2);int(1..)]),(x[3] - 3),(x[4] - 4);int(1..)]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),(x[3] - 3),(x[4] - 4);int(1..)])

--

(x[3] - 3), 
   ~~> minus_to_sum ([("Base", 8400)])
sum([x[3],-(3);int(1..)])

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-(3);int(1..)]),(x[4] - 4);int(1..)]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-3;int(1..)]),(x[4] - 4);int(1..)])

--

(x[4] - 4), 
   ~~> minus_to_sum ([("Base", 8400)])
sum([x[4],-(4);int(1..)])

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-3;int(1..)]),sum([x[4],-(4);int(1..)]);int(1..)]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-3;int(1..)]),sum([x[4],-4;int(1..)]);int(1..)])

--

x[1], 
   ~~> index_to_bubble ([("Bubble", 6000)])
{x[1] @ and([__inDomain(1,int(1..4));int(1..)])}

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([{x[1] @ and([__inDomain(1,int(1..4));int(1..)])},-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-3;int(1..)]),sum([x[4],-4;int(1..)]);int(1..)]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-3;int(1..)]),sum([x[4],-4;int(1..)]);int(1..)])

--

x[2], 
   ~~> index_to_bubble ([("Bubble", 6000)])
{x[2] @ and([__inDomain(2,int(1..4));int(1..)])}

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([{x[2] @ and([__inDomain(2,int(1..4));int(1..)])},-2;int(1..)]),sum([x[3],-3;int(1..)]),sum([x[4],-4;int(1..)]);int(1..)]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-3;int(1..)]),sum([x[4],-4;int(1..)]);int(1..)])

--

x[3], 
   ~~> index_to_bubble ([("Bubble", 6000)])
{x[3] @ and([__inDomain(3,int(1..4));int(1..)])}

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([{x[3] @ and([__inDomain(3,int(1..4));int(1..)])},-3;int(1..)]),sum([x[4],-4;int(1..)]);int(1..)]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-3;int(1..)]),sum([x[4],-4;int(1..)]);int(1..)])

--

x[4], 
   ~~> index_to_bubble ([("Bubble", 6000)])
{x[4] @ and([__inDomain(4,int(1..4));int(1..)])}

--

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-3;int(1..)]),sum([{x[4] @ and([__inDomain(4,int(1..4));int(1..)])},-4;int(1..)]);int(1..)]), 
   ~~> constant_evaluator ([("Constant", 9001)])
allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-3;int(1..)]),sum([x[4],-4;int(1..)]);int(1..)])

--

Final model:

letting dom be domain int(1..n)
letting n be 4
find x: matrix indexed by [dom] of dom

such that

allDiff(x[..]),
allDiff([sum([x[1],1;int(1..)]),sum([x[2],2;int(1..)]),sum([x[3],3;int(1..)]),sum([x[4],4;int(1..)]);int(1..)]),
allDiff([sum([x[1],-1;int(1..)]),sum([x[2],-2;int(1..)]),sum([x[3],-3;int(1..)]),sum([x[4],-4;int(1..)]);int(1..)])

