Model before rewriting:

letting Index be domain int(1..3)
letting Value be domain int(1..9)
letting n be 3
find s: int(1..24)
find square: matrix indexed by [[Index, Index]] of Value

such that

allDiff(flatten(square)),
and([given r: Index

such that

(sum([given c: Index

such that

square[r, c]
 | c: Index,]) = s)
 | r: Index,]),
and([given c: Index

such that

(sum([given r: Index

such that

square[r, c]
 | r: Index,]) = s)
 | c: Index,]),
(sum([given d: Index

such that

square[d, d]
 | d: Index,]) = s),
(sum([given d: Index

such that

square[d, (4 - d)]
 | d: Index,]) = s)

--

allDiff(flatten(square)),
and([given r: Index

such that

(sum([given c: Index

such that

square[r, c]
 | c: Index,]) = s)
 | r: Index,]),
and([given c: Index

such that

(sum([given r: Index

such that

square[r, c]
 | r: Index,]) = s)
 | c: Index,]),
(sum([given d: Index

such that

square[d, d]
 | d: Index,]) = s),
(sum([given d: Index

such that

square[d, (4 - d)]
 | d: Index,]) = s), 
   ~~> substitute_domain_lettings ([("Base", 5000)]) 
allDiff(flatten(square)),
and([given r: Index

such that

(sum([given c: Index

such that

square[r, c]
 | c: Index,]) = s)
 | r: Index,]),
and([given c: Index

such that

(sum([given r: Index

such that

square[r, c]
 | r: Index,]) = s)
 | c: Index,]),
(sum([given d: Index

such that

square[d, d]
 | d: Index,]) = s),
(sum([given d: Index

such that

square[d, (4 - d)]
 | d: Index,]) = s) 

--

Model before rewriting:

find d: Index
find __0: int(1..9)

such that

(0 != __0)

--

(0 != __0), 
   ~~> substitute_domain_lettings ([("Base", 5000)]) 
(0 != __0) 

--

Final model:

find d: int(1..3)
find __0: int(1..9)

such that

(0 != __0)

Model before rewriting:

given d: Index

such that

square[d, d]

--

square[d, d], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[d, d] @ and([__inDomain(d,int(1..3)),__inDomain(d,int(1..3));int(1..)])} 

--

{square[d, d] @ and([__inDomain(d,int(1..3)),__inDomain(d,int(1..3));int(1..)])}, 
   ~~> constant_evaluator ([("Constant", 9001)]) 
square[d, d] 

--

Final model:

given d: Index

such that

square[d, d]

sum([given d: Index

such that

square[d, d]
 | d: int(1..3),__0: int(1..9),]), 
   ~~> expand_comprehension_ac ([("Better_AC_Comprehension_Expansion", 2001)]) 
sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) 

--

Model before rewriting:

find d: Index
find __0: int(1..9)

such that

(0 != __0)

--

(0 != __0), 
   ~~> substitute_domain_lettings ([("Base", 5000)]) 
(0 != __0) 

--

Final model:

find d: int(1..3)
find __0: int(1..9)

such that

(0 != __0)

Model before rewriting:

given d: Index

such that

square[d, (4 - d)]

--

(4 - d), 
   ~~> minus_to_sum ([("Base", 8400)]) 
sum([4,-(d);int(1..)]) 

--

square[d, sum([4,-(d);int(1..)])], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[d, sum([4,-(d);int(1..)])] @ and([__inDomain(d,int(1..3)),__inDomain(sum([4,-(d);int(1..)]),int(1..3));int(1..)])} 

--

{square[d, sum([4,-(d);int(1..)])] @ and([__inDomain(d,int(1..3)),__inDomain(sum([4,-(d);int(1..)]),int(1..3));int(1..)])}, 
   ~~> constant_evaluator ([("Constant", 9001)]) 
{square[d, sum([4,-(d);int(1..)])] @ and([__inDomain(sum([4,-(d);int(1..)]),int(1..3));int(1..)])} 

--

and([__inDomain(sum([4,-(d);int(1..)]),int(1..3));int(1..)]), 
   ~~> remove_unit_vector_and ([("Base", 8800)]) 
__inDomain(sum([4,-(d);int(1..)]),int(1..3)) 

--

Final model:

given d: Index

such that

{square[d, sum([4,-(d);int(1..)])] @ __inDomain(sum([4,-(d);int(1..)]),int(1..3))}

sum([given d: Index

such that

square[d, (4 - d)]
 | d: int(1..3),__0: int(1..9),]), 
   ~~> expand_comprehension_ac ([("Better_AC_Comprehension_Expansion", 2001)]) 
sum([{square[1, sum([4,-(1);int(1..)])] @ __inDomain(sum([4,-(1);int(1..)]),int(1..3))},{square[2, sum([4,-(2);int(1..)])] @ __inDomain(sum([4,-(2);int(1..)]),int(1..3))},{square[3, sum([4,-(3);int(1..)])] @ __inDomain(sum([4,-(3);int(1..)]),int(1..3))};int(1..)]) 

--

allDiff(flatten(square)),
and([given r: Index

such that

(sum([given c: Index

such that

square[r, c]
 | c: Index,]) = s)
 | r: Index,]),
and([given c: Index

such that

(sum([given r: Index

such that

square[r, c]
 | r: Index,]) = s)
 | c: Index,]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([{square[1, sum([4,-(1);int(1..)])] @ __inDomain(sum([4,-(1);int(1..)]),int(1..3))},{square[2, sum([4,-(2);int(1..)])] @ __inDomain(sum([4,-(2);int(1..)]),int(1..3))},{square[3, sum([4,-(3);int(1..)])] @ __inDomain(sum([4,-(3);int(1..)]),int(1..3))};int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff(flatten(square)),
and([given r: Index

such that

(sum([given c: Index

such that

square[r, c]
 | c: Index,]) = s)
 | r: Index,]),
and([given c: Index

such that

(sum([given r: Index

such that

square[r, c]
 | r: Index,]) = s)
 | c: Index,]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

flatten(square), 
   ~~> unwrap_flatten_matrix_nonatomic ([("Smt", 999)]) 
[square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..9)] 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..9)]), 
   ~~> matrix_to_list ([("Base", 2000)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]) 

--

Model before rewriting:

find c: Index
find __0: int(1..9)

such that

(0 != __0)

--

(0 != __0), 
   ~~> substitute_domain_lettings ([("Base", 5000)]) 
(0 != __0) 

--

Final model:

find c: int(1..3)
find __0: int(1..9)

such that

(0 != __0)

Model before rewriting:

given c: Index

such that

square[r, c]

--

square[r, c], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[r, c] @ and([__inDomain(r,int(1..3)),__inDomain(c,int(1..3));int(1..)])} 

--

{square[r, c] @ and([__inDomain(r,int(1..3)),__inDomain(c,int(1..3));int(1..)])}, 
   ~~> constant_evaluator ([("Constant", 9001)]) 
square[r, c] 

--

Final model:

given c: Index

such that

square[r, c]

sum([given c: Index

such that

square[r, c]
 | c: int(1..3),__0: int(1..9),]), 
   ~~> expand_comprehension_ac ([("Better_AC_Comprehension_Expansion", 2001)]) 
sum([square[r, 1],square[r, 2],square[r, 3];int(1..)]) 

--

Model before rewriting:

find r: Index
find __0: bool

such that

(true != __0)

--

(true != __0), 
   ~~> substitute_domain_lettings ([("Base", 5000)]) 
(true != __0) 

--

Final model:

find r: int(1..3)
find __0: bool

such that

(true != __0)

Model before rewriting:

given r: Index

such that

(sum([square[r, 1],square[r, 2],square[r, 3];int(1..)]) = s)

--

Final model:

given r: Index

such that

(sum([square[r, 1],square[r, 2],square[r, 3];int(1..)]) = s)

and([given r: Index

such that

(sum([square[r, 1],square[r, 2],square[r, 3];int(1..)]) = s)
 | r: int(1..3),__0: bool,]), 
   ~~> expand_comprehension_ac ([("Better_AC_Comprehension_Expansion", 2001)]) 
and([(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s);int(1..)]) 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
and([(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s);int(1..)]),
and([given c: Index

such that

(sum([given r: Index

such that

square[r, c]
 | r: Index,]) = s)
 | c: Index,]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([given c: Index

such that

(sum([given r: Index

such that

square[r, c]
 | r: Index,]) = s)
 | c: Index,]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

Model before rewriting:

find r: Index
find __0: int(1..9)

such that

(0 != __0)

--

(0 != __0), 
   ~~> substitute_domain_lettings ([("Base", 5000)]) 
(0 != __0) 

--

Final model:

find r: int(1..3)
find __0: int(1..9)

such that

(0 != __0)

Model before rewriting:

given r: Index

such that

square[r, c]

--

square[r, c], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[r, c] @ and([__inDomain(r,int(1..3)),__inDomain(c,int(1..3));int(1..)])} 

--

{square[r, c] @ and([__inDomain(r,int(1..3)),__inDomain(c,int(1..3));int(1..)])}, 
   ~~> constant_evaluator ([("Constant", 9001)]) 
square[r, c] 

--

Final model:

given r: Index

such that

square[r, c]

sum([given r: Index

such that

square[r, c]
 | r: int(1..3),__0: int(1..9),]), 
   ~~> expand_comprehension_ac ([("Better_AC_Comprehension_Expansion", 2001)]) 
sum([square[1, c],square[2, c],square[3, c];int(1..)]) 

--

Model before rewriting:

find c: Index
find __0: bool

such that

(true != __0)

--

(true != __0), 
   ~~> substitute_domain_lettings ([("Base", 5000)]) 
(true != __0) 

--

Final model:

find c: int(1..3)
find __0: bool

such that

(true != __0)

Model before rewriting:

given c: Index

such that

(sum([square[1, c],square[2, c],square[3, c];int(1..)]) = s)

--

Final model:

given c: Index

such that

(sum([square[1, c],square[2, c],square[3, c];int(1..)]) = s)

and([given c: Index

such that

(sum([square[1, c],square[2, c],square[3, c];int(1..)]) = s)
 | c: int(1..3),__0: bool,]), 
   ~~> expand_comprehension_ac ([("Better_AC_Comprehension_Expansion", 2001)]) 
and([(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s);int(1..)]) 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s);int(1..)]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

Final model:

letting Index be domain int(1..3)
letting Value be domain int(1..9)
letting n be 3
find s: int(1..24)
find square: matrix indexed by [[int(1..3), int(1..3)]] of int(1..9)

such that

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s)

