Model before rewriting:

letting Index be domain int(1..3)
letting Value be domain int(1..9)
letting n be 3
find s: int(1..24)
find square: matrix indexed by [[Index, Index]] of Value

such that

allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([ square[d, d] | d : Index ]) = s),
(sum([ square[d, (4 - d)] | d : Index ]) = s)

--

[ square[d, d] | d : Index ], 
   ~~> expand_comprehension ([("Base", 2000)]) 
[square[1, 1],square[2, 2],square[3, 3];int(1..)] 

--

square[1, 1], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[1, 1] @ and([__inDomain(1,int(1..3)),__inDomain(1,int(1..3));int(1..)])} 

--

allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([{square[1, 1] @ and([__inDomain(1,int(1..3)),__inDomain(1,int(1..3));int(1..)])},square[2, 2],square[3, 3];int(1..)]) = s),
(sum([ square[d, (4 - d)] | d : Index ]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([ square[d, (4 - d)] | d : Index ]) = s) 

--

square[2, 2], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[2, 2] @ and([__inDomain(2,int(1..3)),__inDomain(2,int(1..3));int(1..)])} 

--

allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],{square[2, 2] @ and([__inDomain(2,int(1..3)),__inDomain(2,int(1..3));int(1..)])},square[3, 3];int(1..)]) = s),
(sum([ square[d, (4 - d)] | d : Index ]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([ square[d, (4 - d)] | d : Index ]) = s) 

--

square[3, 3], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[3, 3] @ and([__inDomain(3,int(1..3)),__inDomain(3,int(1..3));int(1..)])} 

--

allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],{square[3, 3] @ and([__inDomain(3,int(1..3)),__inDomain(3,int(1..3));int(1..)])};int(1..)]) = s),
(sum([ square[d, (4 - d)] | d : Index ]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([ square[d, (4 - d)] | d : Index ]) = s) 

--

[ square[d, (4 - d)] | d : Index ], 
   ~~> expand_comprehension ([("Base", 2000)]) 
[square[1, 3],square[2, 2],square[3, 1];int(1..)] 

--

square[1, 3], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[1, 3] @ and([__inDomain(1,int(1..3)),__inDomain(3,int(1..3));int(1..)])} 

--

allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([{square[1, 3] @ and([__inDomain(1,int(1..3)),__inDomain(3,int(1..3));int(1..)])},square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[2, 2], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[2, 2] @ and([__inDomain(2,int(1..3)),__inDomain(2,int(1..3));int(1..)])} 

--

allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],{square[2, 2] @ and([__inDomain(2,int(1..3)),__inDomain(2,int(1..3));int(1..)])},square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[3, 1], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[3, 1] @ and([__inDomain(3,int(1..3)),__inDomain(1,int(1..3));int(1..)])} 

--

allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],{square[3, 1] @ and([__inDomain(3,int(1..3)),__inDomain(1,int(1..3));int(1..)])};int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff(flatten(square)),
and([ (sum([ square[r, c] | c : Index ]) = s) | r : Index ]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

flatten(square), 
   ~~> unwrap_flatten_matrix_nonatomic ([("Smt", 999)]) 
[square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..9)] 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..9)]), 
   ~~> matrix_to_list ([("Base", 2000)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]) 

--

[ square[r, c] | c : Index ], 
   ~~> expand_comprehension ([("Base", 2000)]) 
[square[r, 1],square[r, 2],square[r, 3];int(1..)] 

--

[ (sum([square[r, 1],square[r, 2],square[r, 3];int(1..)]) = s) | r : Index ], 
   ~~> expand_comprehension ([("Base", 2000)]) 
[(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s);int(1..)] 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
and([(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s);int(1..)]),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[1, 1], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[1, 1] @ and([__inDomain(1,int(1..3)),__inDomain(1,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([{square[1, 1] @ and([__inDomain(1,int(1..3)),__inDomain(1,int(1..3));int(1..)])},square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[1, 2], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[1, 2] @ and([__inDomain(1,int(1..3)),__inDomain(2,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],{square[1, 2] @ and([__inDomain(1,int(1..3)),__inDomain(2,int(1..3));int(1..)])},square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[1, 3], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[1, 3] @ and([__inDomain(1,int(1..3)),__inDomain(3,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],{square[1, 3] @ and([__inDomain(1,int(1..3)),__inDomain(3,int(1..3));int(1..)])};int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[2, 1], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[2, 1] @ and([__inDomain(2,int(1..3)),__inDomain(1,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([{square[2, 1] @ and([__inDomain(2,int(1..3)),__inDomain(1,int(1..3));int(1..)])},square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[2, 2], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[2, 2] @ and([__inDomain(2,int(1..3)),__inDomain(2,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],{square[2, 2] @ and([__inDomain(2,int(1..3)),__inDomain(2,int(1..3));int(1..)])},square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[2, 3], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[2, 3] @ and([__inDomain(2,int(1..3)),__inDomain(3,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],{square[2, 3] @ and([__inDomain(2,int(1..3)),__inDomain(3,int(1..3));int(1..)])};int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[3, 1], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[3, 1] @ and([__inDomain(3,int(1..3)),__inDomain(1,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([{square[3, 1] @ and([__inDomain(3,int(1..3)),__inDomain(1,int(1..3));int(1..)])},square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[3, 2], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[3, 2] @ and([__inDomain(3,int(1..3)),__inDomain(2,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],{square[3, 2] @ and([__inDomain(3,int(1..3)),__inDomain(2,int(1..3));int(1..)])},square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[3, 3], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[3, 3] @ and([__inDomain(3,int(1..3)),__inDomain(3,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],{square[3, 3] @ and([__inDomain(3,int(1..3)),__inDomain(3,int(1..3));int(1..)])};int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([ (sum([ square[r, c] | r : Index ]) = s) | c : Index ]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

[ square[r, c] | r : Index ], 
   ~~> expand_comprehension ([("Base", 2000)]) 
[square[1, c],square[2, c],square[3, c];int(1..)] 

--

[ (sum([square[1, c],square[2, c],square[3, c];int(1..)]) = s) | c : Index ], 
   ~~> expand_comprehension ([("Base", 2000)]) 
[(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s);int(1..)] 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
and([(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s);int(1..)]),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[1, 1], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[1, 1] @ and([__inDomain(1,int(1..3)),__inDomain(1,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([{square[1, 1] @ and([__inDomain(1,int(1..3)),__inDomain(1,int(1..3));int(1..)])},square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[2, 1], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[2, 1] @ and([__inDomain(2,int(1..3)),__inDomain(1,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],{square[2, 1] @ and([__inDomain(2,int(1..3)),__inDomain(1,int(1..3));int(1..)])},square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[3, 1], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[3, 1] @ and([__inDomain(3,int(1..3)),__inDomain(1,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],{square[3, 1] @ and([__inDomain(3,int(1..3)),__inDomain(1,int(1..3));int(1..)])};int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[1, 2], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[1, 2] @ and([__inDomain(1,int(1..3)),__inDomain(2,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([{square[1, 2] @ and([__inDomain(1,int(1..3)),__inDomain(2,int(1..3));int(1..)])},square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[2, 2], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[2, 2] @ and([__inDomain(2,int(1..3)),__inDomain(2,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],{square[2, 2] @ and([__inDomain(2,int(1..3)),__inDomain(2,int(1..3));int(1..)])},square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[3, 2], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[3, 2] @ and([__inDomain(3,int(1..3)),__inDomain(2,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],{square[3, 2] @ and([__inDomain(3,int(1..3)),__inDomain(2,int(1..3));int(1..)])};int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[1, 3], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[1, 3] @ and([__inDomain(1,int(1..3)),__inDomain(3,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([{square[1, 3] @ and([__inDomain(1,int(1..3)),__inDomain(3,int(1..3));int(1..)])},square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[2, 3], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[2, 3] @ and([__inDomain(2,int(1..3)),__inDomain(3,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],{square[2, 3] @ and([__inDomain(2,int(1..3)),__inDomain(3,int(1..3));int(1..)])},square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

square[3, 3], 
   ~~> index_to_bubble ([("Bubble", 6000)]) 
{square[3, 3] @ and([__inDomain(3,int(1..3)),__inDomain(3,int(1..3));int(1..)])} 

--

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],{square[3, 3] @ and([__inDomain(3,int(1..3)),__inDomain(3,int(1..3));int(1..)])};int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s), 
   ~~> constant_evaluator ([("Constant", 9001)]) 
allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s) 

--

Final model:

letting Index be domain int(1..3)
letting Value be domain int(1..9)
letting n be 3
find s: int(1..24)
find square: matrix indexed by [[Index, Index]] of Value

such that

allDiff([square[1, 1],square[1, 2],square[1, 3],square[2, 1],square[2, 2],square[2, 3],square[3, 1],square[3, 2],square[3, 3];int(1..)]),
(sum([square[1, 1],square[1, 2],square[1, 3];int(1..)]) = s),
(sum([square[2, 1],square[2, 2],square[2, 3];int(1..)]) = s),
(sum([square[3, 1],square[3, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 1],square[3, 1];int(1..)]) = s),
(sum([square[1, 2],square[2, 2],square[3, 2];int(1..)]) = s),
(sum([square[1, 3],square[2, 3],square[3, 3];int(1..)]) = s),
(sum([square[1, 1],square[2, 2],square[3, 3];int(1..)]) = s),
(sum([square[1, 3],square[2, 2],square[3, 1];int(1..)]) = s)

