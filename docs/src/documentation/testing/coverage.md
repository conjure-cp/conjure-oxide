[//]: # (Author: Calum Cooke)
[//]: # (Last Updated: 12/12/2025)

# Code Coverage

## Introduction
Code coverage is a test which shows how much of the codebase gets automatically tested. There are two main metrics - **Function** and **Line** - both given as percentage points. We use Rust's testing function which comes with cargo, and [GRCov](https://github.com/mozilla/grcov) to generate the reports.

### Line Coverage
Line coverage gives the percentage of lines that were run during testing of all the lines total. It will show which lines were ran during testing, and which were not.

### Function Coverage
Function coverage gives the percentage of _compiler_ functions that were run during testing.

A simple function with no [procedural macros](https://doc.rust-lang.org/reference/procedural-macros.html) will count as _one_ function. However, a function can be extended (e.g. with `#[derive(Debug)]`) which when compiled appear as extra [LLVM](https://llvm.org/) functions. This extra implementation is counted as _another_ function by the coverage report, which means even though you see a single function signature, the report says there are multiple functions. There is no need to test implementations generated by `#[derive(..)]` since those implementations are not written by us.


## How to Test
There are two ways of interrogating code coverage:
- Push your commits to the remote, and look at the PR
- Run `tools/coverage.sh`, and open `target/debug/coverage/index.html` in a browser

The second option (the coverage script) gives a much more verbose breakdown for _which_ areas of the repo are starved of testing, breaking down to each and every line.

## How to Improve
There are numerous way of improving our current code coverage. Below are some some considerations.

### Test-as-you-go
TL;DR - leave the repo in at least as good a condition as you found it.
Make sure whenever you commit something, that you add sufficient tests for it such that the coverage isn't worse than before. This is very easy to forget! 

### Search and Destroy
Use the [coverage script](#how-to-test) to find which files are badly covered, and add tests for them.

## Quirks and Implications
### Cloning (instead of Forking) the Repository
For the most up to date testing advice, look at the [contributing guide](https://github.com/conjure-cp/conjure-oxide/blob/main/CONTRIBUTING.md). As of December 2025, we primarily work by cloning the main repository instead of working in our own forks. To prevent remote code execution, GitHub prevents a GH Action from running code on a fork. This means that our Action for reporting test coverage whenever you push your commits only works if your upstream branch is in the main repository (and not your own fork of it).
